'use client'
import React, { useState, useRef, useEffect } from 'react';

export default function AIAssistant() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState<{ sender: 'user' | 'ai', text: string }[]>([
    { sender: 'ai', text: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‘‹ Ø£Ù†Ø§ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ù„ØªØ·Ø¨ÙŠÙ‚ Face2. Ø£Ù†Ø§ Ø£Ø¹Ø±Ù ÙƒÙ„ ØµØºÙŠØ±Ø© ÙˆÙƒØ¨ÙŠØ±Ø© ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ' }
  ]);
  const [input, setInput] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
  useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages, isOpen]);

  const handleSend = async () => {
    if (!input.trim()) return;
    const userMessage = input.trim();
    
    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    setMessages(prev => [...prev, { sender: 'user', text: userMessage }]);
    setInput('');
    setIsTyping(true);

    // âœ… ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (System Prompt) - Ù…Ø­Ø¯Ø«Ø© ÙˆØ´Ø§Ù…Ù„Ø© Ù„ÙƒÙ„ Ø²Ø± ÙˆÙ…ÙƒØ§Ù† ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    const fullPrompt = `
      Ø£Ù†Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØªÙ‚Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠ ÙˆØ§Ù„Ø®Ø¨ÙŠØ± Ù„ØªØ·Ø¨ÙŠÙ‚ "Face2". Ø£Ù†Øª ØªØ¹Ø±Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£ÙØ¶Ù„ Ù…Ù† Ø£ÙŠ Ø´Ø®Øµ Ø¢Ø®Ø±.
      
      **Ø£Ø³Ù„ÙˆØ¨Ùƒ ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠØ«:**
      - ÙƒÙ† Ù…Ø¨Ø§Ø´Ø±Ø§Ù‹ØŒ Ù…Ø®ØªØµØ±Ø§Ù‹ØŒ ÙˆÙ…ÙÙŠØ¯Ø§Ù‹ Ø¬Ø¯Ø§Ù‹.
      - ØªØ­Ø¯Ø« Ø¨Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø³ÙŠØ·Ø© (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù‡Ø¬Ø© Ø³ÙˆØ¯Ø§Ù†ÙŠØ© Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ "ÙŠØ§ Ø²ÙˆÙ„"ØŒ "ÙŠØ§ Ø­Ø¨ÙŠØ¨" Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„ØªÙ„Ø·ÙŠÙ).
      - ØµÙ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¯Ù‚Ø© (Ù…Ø«Ù„Ø§Ù‹: "Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©"ØŒ "Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…"ØŒ "Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†").
      - Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø­Ø§Ù„ÙŠØ§ ÙÙ‰ ÙˆØ¶Ø¹ ØªØ·ÙˆÙŠØ± ÙŠØªÙŠØ­ Ø§ØªØµØ§Ù„ Ù…Ù† Ø®Ù„Ø§Ù„ ÙˆØ§ÙŠ ÙØ§ÙŠ ÙÙ‚Ø· Ù„Ø§ ÙŠØ¹Ù…Ù„ Ù…Ù† Ø®Ù„Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø§ØªÙ Ù„ÙƒÙ† Ø¨ÙŠ Ø§Ù…ÙƒØ§Ù† Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø§ØªÙ Ø¯Ø±Ø¯Ø´Ù‡ Ù†ØµÙŠÙ‡ Ùˆ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ ØµÙˆØ± Ùˆ Ù…Ù‚Ø·Ø¹ ØµÙˆØª Ù„ÙƒÙ†Ù‡ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§ØªØµØ§Ù„ Ù…Ø«Ù„ Ù…ÙƒØ§Ù„Ù…Ø© ØµÙˆØªÙŠÙ‡ Ø§Ùˆ Ù…ÙƒØ§Ù„Ù…Ø© ÙÙŠØ¯ÙŠÙˆ
      **Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©):**

      ### 1. Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©):
      - **Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ (Logout):** Ø²Ø± Ø£Ø­Ù…Ø± ğŸ”´ Ø¨ÙŠØ¶Ø§ÙˆÙŠ Ø§Ù„Ø´ÙƒÙ„ ÙÙŠ (Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†). ÙˆØ¸ÙŠÙØªÙ‡: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.
      - **Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (Share):** Ø²Ø± Ø¯Ø§Ø¦Ø±ÙŠ Ø£Ø²Ø±Ù‚ ğŸ”µ Ø¨Ø¬Ø§Ù†Ø¨ Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ (Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†). ÙˆØ¸ÙŠÙØªÙ‡: Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø¯Ø¹ÙˆØªÙƒ Ø£Ùˆ Ø¥Ø¸Ù‡Ø§Ø± QR Code.
      - **Ø¹Ù„Ù… Ø§Ù„Ø³ÙˆØ¯Ø§Ù†:** ÙÙŠ (Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±). ÙˆØ¸ÙŠÙØªÙ‡: Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡ ØªØ¸Ù‡Ø± Ù†Ø§ÙØ°Ø© "Ø¹Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" (About).
      - **Ø²Ø± Ø§Ù„Ø­Ø§Ù„Ø© (Status):** Ø²Ø± ØµØºÙŠØ± Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø¹Ù„Ù… (Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±).
        * Ø¥Ø°Ø§ ÙƒØ§Ù† **Ø£Ø®Ø¶Ø±** âœ…: Ø£Ù†Øª "Ù…ØªØ§Ø­".
        * Ø¥Ø°Ø§ ÙƒØ§Ù† **Ø£Ø­Ù…Ø±** â›”: Ø£Ù†Øª "Ù…Ø´ØºÙˆÙ„" (Do Not Disturb).
      - **Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø«:** ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ. ÙˆØ¸ÙŠÙØªÙ‡: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‡Ù… Ø£Ùˆ Ù…Ø±Ø§Ø³Ù„ØªÙ‡Ù….
      - **Ø²Ø± Ø§Ù„Ø³Ø¬Ù„ (History):** Ø²Ø± Ø¹Ø§Ø¦Ù… Ù„ÙˆÙ†Ù‡ Ø±Ù…Ø§Ø¯ÙŠ ØºØ§Ù…Ù‚ ÙÙŠ (Ø£Ø³ÙÙ„ Ø§Ù„ÙŠØ³Ø§Ø±). ÙˆØ¸ÙŠÙØªÙ‡: Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.
      - **Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ (Ø£Ù†Ø§):** Ø²Ø± Ø£Ø²Ø±Ù‚ Ø¹Ø§Ø¦Ù… ğŸ¤– ÙÙŠ (Ø£Ø³ÙÙ„ Ø§Ù„ÙŠØ³Ø§Ø±) ÙÙˆÙ‚ Ø²Ø± Ø§Ù„Ø³Ø¬Ù„.

      ### 2. Ø´Ø§Ø´Ø© Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© (Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„):
      **Ø£. Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ (Control Bar):** ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
         - **Ø²Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:** Ù„ÙˆÙ†Ù‡ Ø±Ù…Ø§Ø¯ÙŠ (Ø´ØºØ§Ù„) Ø£Ùˆ Ø£Ø­Ù…Ø± (Ù…ØºÙ„Ù‚). ÙˆØ¸ÙŠÙØªÙ‡: ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
         - **Ø²Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†:** Ù„ÙˆÙ†Ù‡ Ø±Ù…Ø§Ø¯ÙŠ (Ø´ØºØ§Ù„) Ø£Ùˆ Ø£Ø­Ù…Ø± (Ù…ØºÙ„Ù‚). ÙˆØ¸ÙŠÙØªÙ‡: ÙƒØªÙ… Ø§Ù„ØµÙˆØª.
         - **Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ (Hangup):** Ø²Ø± **Ø£Ø­Ù…Ø± ÙƒØ¨ÙŠØ±** ğŸ”´ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ. ÙˆØ¸ÙŠÙØªÙ‡: Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ÙÙˆØ±Ø§Ù‹.
         - **Ø²Ø± Ø§Ù„Ù‚Ù„Ø¨:** Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù‚Ù„Ø¨ Ø­Ù…Ø±Ø§Ø¡ â¤ï¸ (Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ·). ÙˆØ¸ÙŠÙØªÙ‡: Ø¥Ø±Ø³Ø§Ù„ Ù‚Ù„ÙˆØ¨ Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±.
         - **Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Switch):** (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©/Ø§Ù„Ø®Ù„ÙÙŠØ©.

      **Ø¨. Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© (Tools Menu ğŸ› ï¸):**
         - Ù…ÙƒØ§Ù†Ù‡: Ø²Ø± Ø¹Ø§Ø¦Ù… (Ø¯Ø§Ø¦Ø±ÙŠ ØºØ§Ù…Ù‚) ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨Ù‡ ÙˆØªØ­Ø±ÙŠÙƒÙ‡ ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©.
         - Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡ ØªØ¸Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙˆØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
           1. **Ø£Ù„Ø¹Ø§Ø¨ (XO):** Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙŠØ¯ ØªØ­ÙƒÙ… ğŸ®. Ù„Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© XO Ù…Ø¹ Ø§Ù„ØµØ¯ÙŠÙ‚.
           2. **Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©:** Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø´Ø§Ø´Ø© Ø²Ø±Ù‚Ø§Ø¡/Ø¨Ù†ÙØ³Ø¬ÙŠØ©. Ù„Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±.
           3. **ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØª:** Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹ØµØ§ Ø³Ø­Ø±ÙŠØ© ğŸª„. Ù„ØªØºÙŠÙŠØ± ØµÙˆØªÙƒ Ø¥Ù„Ù‰ (Ø³Ù†Ø¬Ø§Ø¨/Ø·ÙÙ„) Ø£Ùˆ (ÙˆØ­Ø´).
           4. **Ø¬ÙˆØ¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:** Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø®Ø¶Ø±Ø§Ø¡ (SD/HD). Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù†Øª Ø£Ùˆ Ø±ÙØ¹Ù‡Ø§.
           5. **Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©:** Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù‚ÙÙ„ ğŸ”’. Ù„Ù…Ù†Ø¹ Ø§Ù„Ù„Ù…Ø³ Ø§Ù„Ø®Ø·Ø£ (Ù„Ø¥Ù„ØºØ§Ø¦Ù‡ Ø§Ø¶ØºØ· Ù…Ø±ØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©).
           6. **ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ ØµÙˆØ±Ø© (PiP):** Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø±Ø¨Ø¹ÙŠÙ†. Ù„ØªØµØºÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØªØµÙØ­ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø£Ø®Ø±Ù‰.

      ### 3. Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Chat):
      - **Ù…ÙƒØ§Ù†Ù‡Ø§:** ØªÙØªØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø²Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.
      - **Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©):**
        - **Ø²Ø± Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª (Sticker):** Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ¬Ù‡ Ù…Ø¨ØªØ³Ù…. Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„ØµÙ‚Ø§Øª ÙƒØ¨ÙŠØ±Ø©.
        - **Ø²Ø± Ø§Ù„Ù…Ø´Ø¨Ùƒ (Clip):** Ù„Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ± Ù…Ù† Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ.
        - **Ø²Ø± Ø§Ù„Ù…Ø§ÙŠÙƒ (Mic):** (ÙŠÙ…ÙŠÙ† Ø§Ù„Ø®Ø§Ù†Ø©) Ø§Ø¶ØºØ· Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„ØªØ³Ø¬ÙŠÙ„ØŒ ÙˆØ§Ø¶ØºØ· Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„.
      - **Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©:** Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© ØªØ¸Ù‡Ø± Ø®ÙŠØ§Ø±Ø§Øª (Ù†Ø³Ø®ØŒ Ø­Ø°ÙØŒ ØªÙØ§Ø¹Ù„ Ø¨Ø¥ÙŠÙ…ÙˆØ¬ÙŠ).

      ### 4. Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©:
      - **Ø§Ù„Ø´Ø§Ø´Ø© Ø³ÙˆØ¯Ø§Ø¡ØŸ** ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ØŒ Ø£Ùˆ ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ù„Ù… ØªØ¶ØºØ· Ø²Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Ø§Ù„Ø£Ø­Ù…Ø±) Ø¨Ø§Ù„Ø®Ø·Ø£.
      - **Ø§Ù„ØµÙˆØª Ù„Ø§ ÙŠØ¹Ù…Ù„ØŸ** ØªØ£ÙƒØ¯ Ø£Ù† Ø²Ø± Ø§Ù„Ù…Ø§ÙŠÙƒ Ù„ÙŠØ³ Ø£Ø­Ù…Ø±ØŒ ÙˆØ§Ø±ÙØ¹ ØµÙˆØª Ø§Ù„Ù‡Ø§ØªÙ.
      - **Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© ØªÙ‚Ø·Ø¹ØŸ** Ø¬Ø±Ø¨ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Øª (Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…) Ø¥Ù„Ù‰ Low.

      Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ: ${userMessage}
    `;

    try {
      const response = await fetch('/api/ai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ contents: [{ parts: [{ text: fullPrompt }] }] })
      });

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±
      if (!response.ok) {
         const errorData = await response.json().catch(() => ({}));
         console.error("AI Error:", errorData);
         setMessages(prev => [...prev, { sender: 'ai', text: `Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… (${response.status}). Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.` }]);
         setIsTyping(false);
         return;
      }
      
      const data = await response.json();
      
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø±Ø¯ Gemini
      let aiReply = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£Ø³ØªØ·Ø¹ ÙÙ‡Ù… Ø°Ù„Ùƒ. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙŠØ§ØºØ©ØŸ";
      if (data.candidates && data.candidates[0]?.content?.parts[0]?.text) { 
        aiReply = data.candidates[0].content.parts[0].text; 
      }
      
      setMessages(prev => [...prev, { sender: 'ai', text: aiReply }]);

    } catch (error) { 
      console.error("Fetch Error:", error);
      setMessages(prev => [...prev, { sender: 'ai', text: 'ÙŠÙˆØ¬Ø¯ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¬Ø¯Ø¯Ø§Ù‹.' }]); 
    } finally { 
      setIsTyping(false); 
    }
  };

  return (
    <>
      {/* Ø²Ø± ÙØªØ­ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ */}
      {!isOpen && ( 
        <button 
          onClick={() => setIsOpen(true)} 
          style={{ 
            position: 'fixed', bottom: '90px', left: '20px', width: '50px', height: '50px', 
            borderRadius: '50%', backgroundColor: '#4f46e5', color: 'white', border: 'none', 
            boxShadow: '0 4px 15px rgba(79, 70, 229, 0.4)', cursor: 'pointer', zIndex: 1000, 
            display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px', 
            animation: 'fadeIn 0.5s' 
          }} 
          title="Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ"
        > 
          ğŸ¤– 
        </button> 
      )}
      
      {/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */}
      {isOpen && (
        <div style={{ position: 'fixed', bottom: '90px', left: '20px', width: '300px', height: '400px', backgroundColor: '#fff', borderRadius: '20px', boxShadow: '0 10px 40px rgba(0,0,0,0.2)', zIndex: 1001, display: 'flex', flexDirection: 'column', border: '1px solid #e2e8f0', overflow: 'hidden', animation: 'slideUp 0.3s ease-out' }}>
          
          {/* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */}
          <div style={{ padding: '15px', background: '#4f46e5', color: 'white', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}> 
            <span style={{ fontWeight: 'bold', fontSize: '14px' }}>Ù…Ø³Ø§Ø¹Ø¯ Face2 ğŸ¤–</span> 
            <button onClick={() => setIsOpen(false)} style={{ background: 'transparent', border: 'none', color: 'white', fontSize: '18px', cursor: 'pointer' }}>âœ–</button> 
          </div>
          
          {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */}
          <div style={{ flex: 1, padding: '15px', overflowY: 'auto', backgroundColor: '#f8fafc', display: 'flex', flexDirection: 'column', gap: '10px' }}> 
            {messages.map((msg, idx) => ( 
              <div key={idx} style={{ 
                alignSelf: msg.sender === 'user' ? 'flex-start' : 'flex-end', 
                backgroundColor: msg.sender === 'user' ? '#4f46e5' : '#e2e8f0', 
                color: msg.sender === 'user' ? 'white' : '#1e293b', 
                padding: '8px 12px', borderRadius: '12px', 
                borderBottomRightRadius: msg.sender === 'user' ? '2px' : '12px', 
                borderBottomLeftRadius: msg.sender === 'ai' ? '2px' : '12px', 
                maxWidth: '85%', fontSize: '13px', lineHeight: '1.5', textAlign: 'right'
              }}> 
                {msg.text} 
              </div> 
            ))} 
            {isTyping && <div style={{ alignSelf: 'flex-end', fontSize: '12px', color: '#64748b' }}>Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©...</div>} 
            <div ref={messagesEndRef} /> 
          </div>
          
          {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */}
          <div style={{ padding: '10px', borderTop: '1px solid #e2e8f0', display: 'flex', gap: '5px', background: '#fff' }}> 
            <input 
              type="text" 
              value={input} 
              onChange={(e) => setInput(e.target.value)} 
              onKeyDown={(e) => e.key === 'Enter' && handleSend()} 
              placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." 
              style={{ flex: 1, padding: '8px', borderRadius: '20px', border: '1px solid #cbd5e1', outline: 'none', fontSize: '13px', textAlign: 'right', color: '#000' }} 
            /> 
            <button onClick={handleSend} style={{ background: '#4f46e5', color: 'white', border: 'none', borderRadius: '50%', width: '35px', height: '35px', cursor: 'pointer', display:'flex', alignItems:'center', justifyContent:'center' }}>â¤</button> 
          </div>
        </div>
      )}
    </>
  );
}